{% extends 'layout.html' %}
{% block css %}
{% endblock %}
{% block body %}
    <div class="panel-heading">
        <div class="row">
            <div id="info" class="col-md-12">
                <h4>Available Shifts</h4>
            </div>
        </div>
    </div>
    <div class="panel-body">
<div id="available_shifts" class="col-md-12">
<table id="shiftTable" class="shiftTable" border="1">
    <tr>
        {% for i in range(-1, 24*7) %}
            {% if i > -1 %}
                <td>{{i % 24}}:00</td>
            {% else %}
                <td></td>
            {% endif %}
        {% endfor %}
    </tr>
    {% for i, shift in shifts %}
        <tr>
            {% for j in range(-1, 24) %}
                {% if i == 0 %}
                    <td>Shift "{{loop.index0 + 1}}"</td>
                {% else %}
                    <td></td>
                {% endif %}
            {% endfor %}
        </tr>
    {% endfor %}
    <!--
    {% for i in range(-1, 24) %}
        <tr>
            {% for j in range(-1, 7) %}
                {% if j == -1 and i >= 0 %}
                    <td>{{i}}:00</td>
                {% elif i == -1 and j > -1 %}
                    <td>{{days[j]}}</td>
                {% else %}
                    <td></td>
                {% endif %}
            {% endfor %}
        </tr>
    {% endfor %}
    -->
</table>
    <script>console.log("{{upcoming_shifts}}");</script>
{% for shift in upcoming_shifts %}
    {% set start_time = datetime.utcfromtimestamp(shift['adjusted_start']) %}
    {% set end_time = datetime.utcfromtimestamp(shift['adjusted_finish']) %}
    <script>
        table = document.getElementById("shiftTable");
        for (i = parseInt("{{start_time.hour}}"); i < parseInt("{{end_time.hour}}"); i++) {
            table.rows[i].cells["{{start_time.isoweekday()}}"].setAttribute("style", "background-color:green");
            table.rows[i].cells["{{start_time.isoweekday()}}"].onclick = function() {
                console.log("Accepting...");
                $("#accept").click(function() {
                    $.post("/shift/offer/" + "{{shift['id']}}", {}, function(response) {console.log("Successful:" + response)});
                });
                //$("#dialog").dialog()
                $("#dialog").attr("style", "visibility: visible");
            }
        }
    </script>
{% endfor %}
</div>
</div>
</div>
<script>
</script>
<div id="dialog" style="visibility: hidden">
    <div class="row">
    <p>Would you like to accept this shift?</p>
    </div>
    <div class="row">
        <button id="decline">No</button>
        <script>$("#decline").click(function() {$("#dialog").attr("style", "visibility:hidden");})</script>
        <button id="accept">Yes</button>
    </div>
</div>

{% endblock %}